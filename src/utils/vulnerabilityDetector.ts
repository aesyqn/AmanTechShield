import { vulnerabilityPatterns, phishingKeywords, phishingUrlPatterns, idsAnomalies } from './mockData';
export interface Vulnerability {
  id: string;
  type: string;
  severity: 'low' | 'medium' | 'high' | 'critical';
  description: string;
  technicalRisk: number;
  ethicalRisk: number;
  recommendation: string;
  ethicalImplication: string;
}
export function detectPenetrationVulnerabilities(url: string): Vulnerability[] {
  const vulnerabilities: Vulnerability[] = [];

  // Check for HTTP (no SSL)
  if (url.startsWith('http://')) {
    vulnerabilities.push({
      id: `VULN-${Date.now()}-001`,
      type: 'Missing SSL Certificate',
      severity: 'critical',
      description: 'Website uses HTTP instead of HTTPS, exposing data to interception',
      technicalRisk: 5,
      ethicalRisk: 5,
      recommendation: "Implement SSL/TLS certificate immediately. Use Let's Encrypt for free certificates.",
      ethicalImplication: 'Breach of Amanah (trust) - User data transmitted in plain text violates duty to protect customer information.'
    });
  }

  // Simulate weak authentication detection
  if (Math.random() > 0.3) {
    vulnerabilities.push({
      id: `VULN-${Date.now()}-002`,
      type: 'Weak Password Policy',
      severity: 'high',
      description: 'Login page allows weak passwords (no complexity requirements)',
      technicalRisk: 4,
      ethicalRisk: 4,
      recommendation: 'Enforce password rules: minimum 8 characters, uppercase, lowercase, numbers, and special characters.',
      ethicalImplication: 'Negligence in security responsibilities - Weak authentication increases unauthorized access risk, harming user trust.'
    });
  }

  // Simulate missing security headers
  if (Math.random() > 0.4) {
    vulnerabilities.push({
      id: `VULN-${Date.now()}-003`,
      type: 'Missing Security Headers',
      severity: 'medium',
      description: 'Critical security headers not configured (X-Frame-Options, CSP)',
      technicalRisk: 3,
      ethicalRisk: 2,
      recommendation: 'Configure security headers: X-Frame-Options: DENY, Content-Security-Policy, X-Content-Type-Options: nosniff',
      ethicalImplication: 'Inadequate protection measures - Leaves users vulnerable to clickjacking and XSS attacks.'
    });
  }

  // Simulate SQL injection vulnerability
  if (Math.random() > 0.5) {
    vulnerabilities.push({
      id: `VULN-${Date.now()}-004`,
      type: 'SQL Injection Risk',
      severity: 'critical',
      description: 'Input fields vulnerable to SQL injection attacks',
      technicalRisk: 5,
      ethicalRisk: 5,
      recommendation: 'Use parameterized queries and input validation. Implement ORM frameworks.',
      ethicalImplication: 'Severe breach of data protection - Could expose entire customer database, violating privacy rights and trust.'
    });
  }

  // Simulate session management issues
  if (Math.random() > 0.6) {
    vulnerabilities.push({
      id: `VULN-${Date.now()}-005`,
      type: 'Insecure Session Management',
      severity: 'high',
      description: 'Session tokens not properly secured or rotated',
      technicalRisk: 4,
      ethicalRisk: 3,
      recommendation: 'Implement secure session handling: HttpOnly cookies, session timeout, token rotation.',
      ethicalImplication: 'Risk of session hijacking - Compromises user accounts and violates duty of care.'
    });
  }
  return vulnerabilities;
}
export function detectPhishing(content: string, fileName?: string): {
  isPhishing: boolean;
  matches: string[];
  risk: number;
  urlMatches: string[];
  suspiciousPatterns: string[];
} {
  const matches: string[] = [];
  const urlMatches: string[] = [];
  const suspiciousPatterns: string[] = [];
  const lowerContent = content.toLowerCase();

  // Check for phishing keywords (WEIGHTED HEAVILY)
  phishingKeywords.forEach(keyword => {
    if (lowerContent.includes(keyword.toLowerCase())) {
      matches.push(keyword);
    }
  });

  // Check for suspicious URLs (HIGH WEIGHT)
  phishingUrlPatterns.forEach((pattern, index) => {
    if (pattern.test(content)) {
      const patternNames = ['URL Shortener Detected', 'IP Address in URL', 'Multiple @ Symbols', 'Brand Impersonation', 'Suspicious Login URL'];
      urlMatches.push(patternNames[index] || 'Suspicious URL Pattern');
    }
  });

  // Check for suspicious patterns (MEDIUM WEIGHT)
  if (/\$\d+|\d+\s*(million|thousand|USD|EUR|GBP)/i.test(content)) {
    suspiciousPatterns.push('Large monetary amounts mentioned');
  }
  if (/<a\s+href=["'][^"']*["'][^>]*>(?!.*\1)/i.test(content)) {
    suspiciousPatterns.push('Mismatched link text and URL');
  }
  if (/password|credit\s*card|ssn|social\s*security/i.test(content)) {
    suspiciousPatterns.push('Requests sensitive information');
  }
  if (content.match(/!/g)?.length > 5) {
    suspiciousPatterns.push('Excessive exclamation marks (urgency tactic)');
  }
  if (/dear\s+(customer|user|member|sir|madam)/i.test(content)) {
    suspiciousPatterns.push('Generic greeting (not personalized)');
  }

  // Check file extension for image/PDF phishing
  if (fileName) {
    const ext = fileName.toLowerCase();
    if (ext.endsWith('.pdf') || ext.endsWith('.jpg') || ext.endsWith('.png')) {
      suspiciousPatterns.push('Attachment-based phishing (OCR analysis performed)');
    }
  }

  // ENHANCED RISK CALCULATION - Much more sensitive
  // Keywords are now weighted at 60% (was 40%)
  // Each keyword contributes more to the score
  const keywordScore = Math.min(matches.length / phishingKeywords.length * 100, 60) + matches.length * 8;

  // URL matches are now 25 points each (was 20)
  const urlScore = urlMatches.length * 25;

  // Pattern matches are now 15 points each (was 10)
  const patternScore = suspiciousPatterns.length * 15;

  // Calculate final risk score
  const risk = Math.min(keywordScore + urlScore + patternScore, 100);

  // LOWERED THRESHOLD - More sensitive detection
  // Previously: 3+ keywords OR 2+ URLs OR 3+ patterns
  // Now: 2+ keywords OR 1+ URL OR 2+ patterns OR risk > 40%
  const isPhishing = matches.length >= 2 || urlMatches.length >= 1 || suspiciousPatterns.length >= 2 || risk > 40;
  return {
    isPhishing,
    matches,
    risk,
    urlMatches,
    suspiciousPatterns
  };
}
export function analyzeIDSLogs(logData: string): Vulnerability[] {
  const vulnerabilities: Vulnerability[] = [];
  const lines = logData.split('\n');

  // Simulate failed login detection
  const failedLogins = lines.filter(line => line.toLowerCase().includes('failed') || line.toLowerCase().includes('unauthorized')).length;
  if (failedLogins > idsAnomalies.failedLogins.threshold) {
    vulnerabilities.push({
      id: `IDS-${Date.now()}-001`,
      type: 'Excessive Failed Login Attempts',
      severity: 'high',
      description: `Detected ${failedLogins} failed login attempts - possible brute force attack`,
      technicalRisk: 4,
      ethicalRisk: 3,
      recommendation: 'Implement account lockout policy, CAPTCHA, and rate limiting. Monitor for distributed attacks.',
      ethicalImplication: 'Potential breach attempt - Duty to protect user accounts and notify affected parties.'
    });
  }

  // Simulate unusual access patterns
  if (Math.random() > 0.4) {
    vulnerabilities.push({
      id: `IDS-${Date.now()}-002`,
      type: 'Unusual Access Patterns',
      severity: 'medium',
      description: 'Multiple access attempts from different geographic locations within short timeframe',
      technicalRisk: 3,
      ethicalRisk: 3,
      recommendation: 'Implement geo-blocking, multi-factor authentication, and behavioral analysis.',
      ethicalImplication: 'Suspicious activity indicating possible account compromise - Requires immediate user notification.'
    });
  }

  // Simulate data exfiltration attempt
  if (Math.random() > 0.6) {
    vulnerabilities.push({
      id: `IDS-${Date.now()}-003`,
      type: 'Abnormal Data Transfer',
      severity: 'critical',
      description: 'Unusually large data transfers detected - possible data exfiltration',
      technicalRisk: 5,
      ethicalRisk: 5,
      recommendation: 'Immediately investigate and block suspicious connections. Review data access logs.',
      ethicalImplication: 'Critical breach of data protection - Potential mass data theft requires immediate disclosure and remediation.'
    });
  }
  return vulnerabilities;
}
export function calculateRiskScore(vulnerabilities: Vulnerability[]): {
  overall: number;
  technical: number;
  ethical: number;
  critical: number;
  high: number;
  medium: number;
  low: number;
} {
  if (vulnerabilities.length === 0) {
    return {
      overall: 0,
      technical: 0,
      ethical: 0,
      critical: 0,
      high: 0,
      medium: 0,
      low: 0
    };
  }
  const technical = vulnerabilities.reduce((sum, v) => sum + v.technicalRisk, 0) / vulnerabilities.length;
  const ethical = vulnerabilities.reduce((sum, v) => sum + v.ethicalRisk, 0) / vulnerabilities.length;
  const overall = (technical + ethical) / 10 * 100;
  const critical = vulnerabilities.filter(v => v.severity === 'critical').length;
  const high = vulnerabilities.filter(v => v.severity === 'high').length;
  const medium = vulnerabilities.filter(v => v.severity === 'medium').length;
  const low = vulnerabilities.filter(v => v.severity === 'low').length;
  return {
    overall,
    technical,
    ethical,
    critical,
    high,
    medium,
    low
  };
}

// Simulate OCR text extraction from images/PDFs
export function extractTextFromFile(file: File): Promise<string> {
  return new Promise(resolve => {
    // Simulate OCR processing delay
    setTimeout(() => {
      // Simulate extracted text with potential phishing content
      const simulatedTexts = ['URGENT: Your account has been suspended. Click here now to verify your identity and reactivate your account immediately. Failure to act within 24 hours will result in permanent account closure.', 'Congratulations! You have won $1,000,000 in our prize draw. To claim your reward, please confirm your identity by providing your credit card details and social security number.', 'Dear Customer, We have detected unusual activity on your account. Please update your payment information immediately to avoid service interruption. Click the link below to verify your billing details.', 'Security Alert: Your password will expire in 24 hours. Reset your password now by clicking this link to maintain access to your account.', 'This is a legitimate business email regarding your recent transaction. Thank you for your purchase.'];
      const randomText = simulatedTexts[Math.floor(Math.random() * simulatedTexts.length)];
      resolve(randomText);
    }, 1500);
  });
}